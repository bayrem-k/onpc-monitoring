---
# Copyright 2016, Rackspace US, Inc.
# Copyright 2018, OpenNext SAS
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.


# Grafana server vars
grafana_version: 3.1.1-*
grafana_apt_repository: deb https://packagecloud.io/grafana/stable/debian/ jessie main
grafana_plugins_install: ['grafana-clock-panel']
grafana_http_addr: "{{ hostvars[inventory_hostname]['ansible_host'] | default('0.0.0.0') }}"
grafana_http_port: 8089 
# Grafana database vars
grafana_type: mysql                       # Either "mysql", "postgres" or "sqlite3"
grafana_host: "{{ galera_address|default('127.0.0.1') }}:3306"
grafana_name: grafana_test
grafana_user: grafana_test
grafana_password: "{{ grafana_password_secret }}"
# Grafana security vars
grafana_admin_user: admin
grafana_admin_password: "{{ grafana_admin_password_secret }}"
# Anonymous Auth
grafana_anonymous_enabled: false
grafana_anonymous_org_name: Main Org.
grafana_anonymous_org_role: Viewer

# InfluxDB vars
influxdb_admin_port: 8083
influxdb_port: 8086
influxdb_db_name: telegraf
influxdb_db_retention: 32d
influxdb_db_retention_policy: openstack
influxdb_db_replication: 1
influxdb_db_metric_user: openstack
influxdb_db_metric_password: "{{ influxdb_db_metric_password_secret }}"
influxdb_db_root_name_secret: root
influxdb_db_root_password: "{{ influxdb_db_root_password_secret }}"

# WAL dir could use tempfs instead to reduce disk iops overhead
influxdb_wal_dir: /var/lib/influxdb/wal
influxdb_wal_logging_enabled: true
influxdb_query_log_enabled: false
influxdb_cache_max_memory_size: 679477248
influxdb_cache_snapshot_memory_size: 28311552

# Kapacitor Vars
kapacitor_port: 9092

# Influxdb Relay vars
influxdb_relay_port: 9096

# Collectd vars
collectd_version: 5.8
collectd_service: systemd
collectd_python_module_path: "{{ collectd_plugins_dir + '/python' }}"
collectd_default_plugins: []
collectd_plugins: [python]
collectd_plugins_options:
  ModulePath "{{ collectd_python_module_path }}""
  LogTraces true
  Interactive true
  <% @modules.sort.each do |module_name,config| -%>
    <Module "<%= module_name %>">
  <%   config.sort.each do |key,value| -%>
        <%- if value.is_a?(Hash) -%>
            <%- value.sort.each do |original,new| -%>
           <%= key -%> "<%= original -%>" "<%= new -%>"
            <%- end -%>
        <%- elsif value.is_a?(Array) -%>
            <% value.sort.each do |x| -%>
           <%= key -%> "<%= x -%>"
            <% end -%>
        <%- else -%>
           <%= key -%> "<%= value -%>"
        <%- end -%>
<%   end -%>
    </Module>
<% end -%> 


# Prometheus Client Outputs Plugin
#outputs_prometheus_client: true
#outputs_prometheus_client_listen: ":9126"
#outputs_prometheus_client_expiration_interval: "60s"
