# This file was generated by Ansible for {{ansible_fqdn}}
# Do NOT modify this file by hand!
{% if inventory_hostname in groups['collectd'] %}
# Python plugins to monitor OpenStack
<LoadPlugin python>
  Globals true
</LoadPlugin>

<Plugin "python">
  ModulePath "{{ collectd_plugins_dir }}/collectd-modules"
  LogTraces false
  Interactive false

  Import "check_openstack_api"

  <Module "check_openstack_api">
    DependsOnResource "internal_lb_vip_address"
    KeystoneUrl "{{ keystone_service_internaluri }}/v2.0"
    Password "{{ monitoring_user_password }}"
    Tenant "{{ monitoring_tenant_name }}"
    Timeout "5"
    Username "{{ monitoring_user_name }}"
  </Module>

  Import "http_check"

  <Module "http_check">
    DependsOnResource "internal_lb_vip_address"
    ExpectedCode "influxdb" "204"
    MaxRetries "3"
    Timeout "1"
    Url "influxdb" "{{ influxdb_service_internalurl }}"
  </Module>

  Import "compute_stats"

  <Module "compute_stats">
    CpuAllocationRatio "8.0"
    DependsOnResource "internal_lb_vip_address"
    KeystoneUrl "{{ keystone_service_internaluri }}/v2.0"
    Password "{{ monitoring_user_password }}"
    Tenant "{{ monitoring_tenant_name }}"
    Timeout "5"
    Username "{{ monitoring_user_name }}"
  </Module>

 Import "openstack_cinder"

  <Module "openstack_cinder">
    DependsOnResource "internal_lb_vip_address"
    KeystoneUrl "{{ keystone_service_internaluri }}/v2.0"
    MaxRetries "3"
    Password "{{ monitoring_user_password }}"
    Tenant "{{ monitoring_tenant_name }}"
    Timeout "5"
    Username "{{ monitoring_user_name }}"
  </Module>

  Import "openstack_glance"

  <Module "openstack_glance">
    DependsOnResource "internal_lb_vip_address"
    KeystoneUrl "{{ keystone_service_internaluri }}/v2.0"
    MaxRetries "3"
    Password "{{ monitoring_user_password }}"
    Tenant "{{ monitoring_tenant_name }}"
    Timeout "5"
    Username "{{ monitoring_user_name }}"
  </Module>

  Import "openstack_keystone"

  <Module "openstack_keystone">
    DependsOnResource "internal_lb_vip_address"
    KeystoneUrl "{{ keystone_service_internaluri }}/v2.0"
    MaxRetries "3"
    Password "{{ monitoring_user_password }}"
    Tenant "{{ monitoring_tenant_name }}"
    Timeout "5"
    Username "{{ monitoring_user_name }}"
  </Module>

  Import "openstack_neutron"

  <Module "openstack_neutron">
    DependsOnResource "internal_lb_vip_address"
    KeystoneUrl "{{ keystone_service_internaluri }}/v2.0"
    MaxRetries "3"
    Password "{{ monitoring_user_password }}"
    Tenant "{{ monitoring_tenant_name }}"
    Timeout "5"
    Username "{{ monitoring_user_name }}"
  </Module>

 Import "openstack_nova"

  <Module "openstack_nova">
    DependsOnResource "internal_lb_vip_address"
    KeystoneUrl "{{ keystone_service_internaluri }}/v2.0"
    MaxRetries "3"
    Password "{{ monitoring_user_password }}"
    Tenant "{{ monitoring_tenant_name }}"
    Timeout "5"
    Username "{{ monitoring_user_name }}"
  </Module>

</Plugin>
{% endif %}
